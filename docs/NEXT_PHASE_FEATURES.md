# 来期拡張機能提案書

## 概要

本ドキュメントは、ProofLink Test Case DB の現状分析に基づき、来期に追加すべき機能を優先度別に整理したものです。

---

## 1. セキュリティ・認証基盤の強化【最優先】

現在の認証はモックベースであり、本番運用に向けて最も優先度が高い領域です。

### 1.1 認証システムの本格実装

- **JWT トークンの適切な管理**: アクセストークン（短寿命）+ リフレッシュトークン（長寿命）の二段構成
- **セッション管理の強化**: サーバーサイドセッション管理、同時ログインの制御
- **パスワードポリシーの導入**: 最小文字数、複雑性要件、パスワード履歴の管理
- **アカウントロック機能**: ログイン試行回数の制限、一定回数失敗時の自動ロック
- **多要素認証（MFA）**: TOTP ベースの二要素認証対応

### 1.2 監査ログ（Audit Log）

- 誰が・いつ・何を操作したかを記録する監査証跡機能
- テストケースの変更履歴、結果の編集履歴の完全なトレーサビリティ
- 監査ログの検索・エクスポート機能
- 自動車業界の品質管理規格（ISO 26262 等）への対応基盤

---

## 2. テスト管理機能の拡充【高優先】

### 2.1 ダッシュボード・レポート機能

- **テスト進捗ダッシュボード**: テストグループ全体の進捗率、OK/NG/未実施の割合をリアルタイム表示
- **日次・週次レポート自動生成**: テスト進捗のサマリーを自動集計し PDF/Excel 出力
- **NG 分析レポート**: NG 項目の傾向分析、発生頻度の高い不具合パターンの可視化
- **テストカバレッジマトリクス**: テスト対象項目 vs テスト実施状況のマトリクス表示

### 2.2 テスト実行ワークフロー

- **テスト計画機能**: テスト実行のスケジューリング、担当者のアサイン管理
- **テスト実行のステータス管理**: 未着手 → 実施中 → レビュー中 → 完了 のワークフロー
- **テスト結果の承認フロー**: NG → 対策 → 再テスト → 承認 の流れを管理
- **一括テスト結果登録**: 複数テストケースの結果を一画面で効率的に入力

### 2.3 テストケーステンプレート

- 頻出するテストパターンのテンプレート化
- テンプレートからの一括テストケース生成
- OEM/モデル間でのテストケース流用・差分管理

---

## 3. データ連携・インポート/エクスポート強化【高優先】

### 3.1 テストケースのエクスポート強化

- **Excel エクスポート**: テストケース一覧、結果一覧の Excel 出力（現在の ExcelJS を活用）
- **PDF レポート出力**: テスト結果サマリーの公式レポートとして PDF 出力
- **カスタムフォーマット対応**: OEM ごとに異なるレポートフォーマットへの対応

### 3.2 外部ツール連携

- **JIRA/Redmine 連携**: NG 項目の自動チケット起票、ステータス同期
- **CI/CD パイプライン連携**: 自動テスト結果の取り込み API
- **Slack/Teams 通知**: テスト完了、NG 発生時のリアルタイム通知

### 3.3 S3 ファイル管理の改善

- **S3 ディレクトリのクリーンアップ実装**: テストグループ削除時の S3 ファイル削除（既知 TODO）
- **ファイルバージョン管理**: エビデンスファイルの版管理
- **ファイルプレビュー**: 画像・PDF のインラインプレビュー表示

---

## 4. ユーザビリティ向上【中優先】

### 4.1 検索・フィルタリングの強化

- **全文検索**: テストケース内容、目的、手順をまたいだ横断検索
- **高度なフィルタリング**: 複数条件の AND/OR 組み合わせフィルタ
- **保存済みフィルタ**: よく使うフィルタ条件の保存・共有機能
- **タグベースのナビゲーション**: タグによるテストグループ/テストケースの絞り込み強化

### 4.2 UI/UX の改善

- **ダークモード対応**: 長時間作業の負担軽減
- **テーブルのカラムカスタマイズ**: ユーザーごとの表示カラム設定保存
- **ドラッグ & ドロップ**: テストケースの並び替え、ファイルアップロード
- **キーボードショートカット**: パワーユーザー向けの効率的な操作
- **レスポンシブ対応の強化**: タブレットでの現場利用を想定したモバイル対応

### 4.3 通知機能

- **アプリ内通知**: テスト結果の変更、担当タスクの通知
- **メール通知**: 重要なイベント（NG 大量発生、テスト期限超過等）の通知
- **通知設定のカスタマイズ**: ユーザーごとの通知レベル・チャネル設定

---

## 5. 品質・運用基盤の強化【中優先】

### 5.1 テストカバレッジの拡充

- **ユニットテストの充実**: 現在 3 ファイルのみ → 主要コンポーネント・API ルートの網羅
- **E2E テスト導入**: Playwright を用いた主要フローの自動テスト
- **API テスト**: テストグループ/テストケース CRUD の自動テスト
- **テストカバレッジ目標**: ステートメントカバレッジ 80% 以上

### 5.2 パフォーマンス最適化

- **ページネーションの最適化**: 大量データ（10,000 件超）での検索レスポンス改善
- **DB インデックス最適化**: クエリ実行計画の分析に基づくインデックス追加
- **キャッシュ戦略**: Redis 等を用いたクエリ結果キャッシュ
- **画像最適化**: Next.js Image コンポーネントの活用、エビデンス画像のサムネイル生成

### 5.3 エラーハンドリング・可観測性の向上

- **構造化エラーレスポンス**: API エラーの統一的なレスポンス形式
- **ヘルスチェックエンドポイント**: `/api/health` による死活監視
- **メトリクス収集**: レスポンスタイム、エラー率のモニタリング
- **アラート設定**: CloudWatch Alarm による異常検知・通知

---

## 6. 高度な分析機能【低優先・将来検討】

### 6.1 テスト分析・BI

- **トレンド分析**: テスト結果の推移グラフ（React ChartJS2 を活用）
- **不具合パターン分析**: NG が多発するレイヤー/カテゴリの特定
- **テスト工数分析**: テスト実行の所要時間・工数の可視化
- **予測分析**: 過去データに基づくテスト完了予測

### 6.2 AI/自動化機能

- **テストケース自動生成支援**: 既存テストケースからの類似ケース提案
- **NG 原因の類似事例検索**: 過去の NG パターンとの照合
- **自然言語によるテストケース検索**: LLM を活用した柔軟な検索

### 6.3 マルチテナント対応

- **組織ベースのデータ分離**: 複数企業/部門での利用に向けたテナント分離
- **テナントごとのロール・権限管理**
- **テナント横断のレポーティング**

---

## 実装優先度サマリー

| 優先度 | カテゴリ | 概要 |
|--------|----------|------|
| **最優先** | セキュリティ・認証 | 認証本格実装、監査ログ |
| **高** | テスト管理拡充 | ダッシュボード、ワークフロー、テンプレート |
| **高** | データ連携強化 | エクスポート、外部ツール連携、S3 改善 |
| **中** | ユーザビリティ | 検索強化、UI/UX 改善、通知 |
| **中** | 品質・運用基盤 | テストカバレッジ、パフォーマンス、可観測性 |
| **低** | 高度な分析 | BI、AI 支援、マルチテナント |

---

## 技術的な前提・注意事項

- 既存の Next.js 15 / React 19 / Prisma 6 のスタックを継続利用
- AWS インフラ（ECS, S3, Batch, RDS）を基盤として拡張
- 段階的なリリースを想定し、各機能は独立してデプロイ可能な設計とする
- 自動車業界の品質管理規格（ISO 26262, ASPICE 等）への準拠を意識した設計
