@startuml System Architecture
title testcasedbシステムアーキテクチャ図

package "クライアント層" {
  component "ブラウザ\n(Chrome, Firefox等)" as browser
  component "React\nコンポーネント" as react
}

package "フロントエンド層" {
  component "ログイン画面" as login_page
  component "テストグループ一覧画面" as list_page
  component "テストグループ新規作成画面" as create_page
  component "テストグループ編集画面" as edit_page
}

package "Next.js App Router層" {
  component "Server Actions\n(getData, saveData等)" as server_actions
  component "ページコンポーネント\n(Server Components)" as page_components
}

package "API Routes層" {
  component "GET /api/test-groups" as get_groups_api
  component "POST /api/test-groups" as post_groups_api
  component "PUT /api/test-groups/[id]" as put_groups_api
  component "DELETE /api/test-groups/[id]" as delete_groups_api
  component "GET /api/tags" as get_tags_api
  component "GET /api/test-cases" as get_cases_api
}

package "認証・認可層" {
  component "NextAuth.js\n認証エンジン" as nextauth
  component "権限チェック関数\n(requireAuth, canViewTestGroup等)" as auth_check
}

package "ビジネスロジック層" {
  component "Zod Validation\nスキーマ" as zod_validation
  component "エラーハンドリング" as error_handling
}

database "AWS RDS\n(PostgreSQL)" as rds {
  component "mt_users\n(ユーザーテーブル)" as users_table
  component "tt_test_groups\n(テストグループテーブル)" as groups_table
  component "tt_test_cases\n(テストケーステーブル)" as cases_table
  component "mt_tags\n(タグテーブル)" as tags_table
  component "tt_test_group_tags\n(グループタグ関連付けテーブル)" as group_tags_table
  component "tt_test_contents\n(テストコンテンツテーブル)" as contents_table
}

package "外部サービス" {
  component "AWS S3\n(ドキュメント保存)" as s3
}

browser --> react
react --> login_page
react --> list_page
react --> create_page
react --> edit_page

login_page --> page_components
list_page --> page_components
create_page --> page_components
edit_page --> page_components

page_components --> server_actions
server_actions --> get_groups_api
server_actions --> post_groups_api
server_actions --> put_groups_api
server_actions --> delete_groups_api
server_actions --> get_tags_api

login_page --> nextauth
get_groups_api --> auth_check
post_groups_api --> auth_check
put_groups_api --> auth_check
delete_groups_api --> auth_check

post_groups_api --> zod_validation
put_groups_api --> zod_validation
login_page --> zod_validation

get_groups_api --> error_handling
post_groups_api --> error_handling
put_groups_api --> error_handling
delete_groups_api --> error_handling

get_groups_api --> groups_table
post_groups_api --> groups_table
put_groups_api --> groups_table
delete_groups_api --> groups_table

post_groups_api --> group_tags_table
put_groups_api --> group_tags_table

get_tags_api --> tags_table
get_cases_api --> cases_table

users_table --> groups_table
groups_table --> cases_table
groups_table --> group_tags_table
tags_table --> group_tags_table
cases_table --> contents_table

get_groups_api --> s3
get_cases_api --> s3
@enduml
