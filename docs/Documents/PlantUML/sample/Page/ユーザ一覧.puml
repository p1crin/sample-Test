@startuml ユーザー管理画面
autonumber
actor "ログインユーザー" as User
participant "画面\n(/users)" as Screen
participant "API\n(/api/users)" as API

User -> Screen: 画面アクセス
activate Screen
Screen -> Screen: useSession()で権限確認
alt 管理者 (user_role === 0)
    Screen -> API: GET /api/users
    activate API
    API -> API: JWTトークン検証
    API -> API: 管理者権限確認
    API -> API: SELECT u.*, GROUP_CONCAT(t.tag_name) AS tags\nFROM mt_users u\nLEFT JOIN mt_user_tags ut ON u.user_id = ut.user_id\nLEFT JOIN mt_tags t ON ut.tag_id = t.tag_id\nWHERE u.is_deleted = FALSE\nGROUP BY u.user_id
    API -> Screen: 200 OK\n{ users: [...] }
    deactivate API
    Screen -> User: ユーザー一覧表示
else 管理者以外
    Screen -> User: /test-groupsにリダイレクト
end
deactivate Screen
@enduml