@startuml 集計画面
autonumber
actor "ログインユーザー" as User
participant "画面\n(/test-groups/[groupId]/report)" as Screen
participant "API\n(/api/test-groups/[groupId]/report-data)" as API

User -> Screen: 画面アクセス
activate Screen
Screen -> API: GET /api/test-groups/[groupId]
activate API
API -> API: JWTトークン検証
API -> API: SELECT * FROM tt_test_groups\nWHERE test_group_id = $1
API -> Screen: 200 OK\n{ testGroup }
deactivate API

Screen -> API: GET /api/test-groups/[groupId]/report-data
activate API
API -> API: JWTトークン検証
API -> API: 閲覧権限確認
API -> API: SELECT COUNT(*) AS total_cases\nFROM tt_test_contents\nWHERE is_target = TRUE
API -> API: SELECT COUNT(*) AS ok_cases\nFROM tt_test_results tr\nJOIN tt_test_contents tc\nON tr.test_content_id = tc.test_content_id\nWHERE tc.is_target = TRUE AND tr.judgment = 1
API -> API: SELECT execution_date, COUNT(*) AS ng_count\nFROM tt_test_results tr\nJOIN tt_test_contents tc\nON tr.test_content_id = tc.test_content_id\nWHERE tc.is_target = TRUE AND tr.judgment = 0\nGROUP BY execution_date
API -> Screen: 200 OK\n{ totalCases, okCases, ngCases, bugCurve: [...] }
deactivate API
Screen -> Screen: Rechartsでグラフ生成
Screen -> User: レポート表示\n(円グラフ, バグ曲線)
deactivate Screen
@enduml