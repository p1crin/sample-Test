# AWS ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹é †æ›¸ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå…¬é–‹ç‰ˆãƒ»ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã‚¢ã‚¯ã‚»ã‚¹ï¼‰

## ç›®æ¬¡

1. [å‰ææ¡ä»¶](#1-å‰ææ¡ä»¶)
2. [å…¨ä½“æ§‹æˆæ¦‚è¦](#2-å…¨ä½“æ§‹æˆæ¦‚è¦)
3. [VPC ã®ä½œæˆ](#3-vpc-ã®ä½œæˆ)
4. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ](#4-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ)
5. [RDS PostgreSQL ã®ä½œæˆ](#5-rds-postgresql-ã®ä½œæˆ)
6. [S3 ãƒã‚±ãƒƒãƒˆã®ä½œæˆ](#6-s3-ãƒã‚±ãƒƒãƒˆã®ä½œæˆ)
7. [Secrets Manager ã®è¨­å®š](#7-secrets-manager-ã®è¨­å®š)
8. [IAM ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ](#8-iam-ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ)
9. [ECR ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ](#9-ecr-ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ)
10. [ECS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ](#10-ecs-ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ)
11. [ACM è¨¼æ˜æ›¸ã®å–å¾—](#11-acm-è¨¼æ˜æ›¸ã®å–å¾—)
12. [WAF ã®è¨­å®šï¼ˆå¿…é ˆï¼‰](#12-waf-ã®è¨­å®šå¿…é ˆ)
13. [Application Load Balancer ã®ä½œæˆ](#13-application-load-balancer-ã®ä½œæˆ)
14. [Route 53 DNS è¨­å®š](#14-route-53-dns-è¨­å®š)
15. [AWS Batch ã®è¨­å®š](#15-aws-batch-ã®è¨­å®š)
16. [CloudWatch ã®è¨­å®š](#16-cloudwatch-ã®è¨­å®š)
17. [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#17-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
18. [å‹•ä½œç¢ºèª](#18-å‹•ä½œç¢ºèª)
19. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#19-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
20. [æ³¨æ„äº‹é …ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#20-æ³¨æ„äº‹é …ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. å‰ææ¡ä»¶

### 1.1 å¿…è¦ãªã‚‚ã®

- AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆAdmin æ¨©é™ã‚ã‚Šï¼‰
- AWS CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Docker ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹: testcasedb.example.comï¼‰
- **å®¢å…ˆã®ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå›ºå®šIPï¼‰**

### 1.2 AWS CLI ã®è¨­å®š

```bash
# AWS CLI ã®è¨­å®š
aws configure

# ä»¥ä¸‹ã‚’å…¥åŠ›
# AWS Access Key ID: [ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ID]
# AWS Secret Access Key: [ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼]
# Default region name: ap-northeast-1
# Default output format: json
```

### 1.3 ä½¿ç”¨ã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³

æœ¬æ‰‹é †ã§ã¯ **ap-northeast-1ï¼ˆæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰** ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### 1.4 äº‹å‰ã«ç¢ºèªã™ã¹ãæƒ…å ±

| ç¢ºèªé …ç›® | ä¾‹ | ç”¨é€” |
|---------|-----|------|
| ãƒ‰ãƒ¡ã‚¤ãƒ³å | testcasedb.example.com | ALBã€ACMè¨¼æ˜æ›¸ |
| **ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼IP** | **203.0.113.50/32** | **WAFã€SG ã§ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™** |
| ç®¡ç†è€…ç”¨ IPï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | 203.0.113.100/32 | ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ç”¨ |

> **é‡è¦**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…ãšå®¢å…ˆã®ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·IPã¯å›ºå®šIPã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## 2. å…¨ä½“æ§‹æˆæ¦‚è¦

### 2.1 ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢å…ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆç¤¾å†…ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰                                    â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚ ç®¡ç†è€…PC  â”‚  â”‚ ä¸€èˆ¬PC   â”‚  â”‚ ãƒªãƒ¢ãƒ¼ãƒˆ â”‚                    â”‚  â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ ãƒ¯ãƒ¼ã‚¯   â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚        â”‚             â”‚             â”‚                           â”‚  â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚  â”‚
â”‚  â”‚               â”‚                                                 â”‚  â”‚
â”‚  â”‚               â–¼                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
â”‚  â”‚  â”‚  ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼         â”‚                                   â”‚  â”‚
â”‚  â”‚  â”‚  (å›ºå®šIP: 203.0.113.50) â”‚                                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                                                    â”‚
â”‚                 â”‚ HTTPS (443)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚            AWS Cloud                               â”‚
â”‚                 â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AWS WAF (ãƒ—ãƒ­ã‚­ã‚·IPåˆ¶é™ + ãƒ¬ãƒ¼ãƒˆåˆ¶é™)                           â”‚ â”‚
â”‚  â”‚  è¨±å¯IP: 203.0.113.50/32 ã®ã¿                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          â”‚       VPC (10.0.0.0/16)               â”‚ â”‚
â”‚  â”‚                          â”‚                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚                    Public Subnet                             â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Internet-facing â”‚                                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  ALB             â”‚                                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  + ãƒ—ãƒ­ã‚­ã‚·IPåˆ¶é™ â”‚                                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                                                  â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚              â”‚                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚           â”‚       Private Subnet                             â”‚â”‚ â”‚
â”‚  â”‚  â”‚           â–¼                                                  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚      ECS Fargate                                      â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹DBã‚¢ãƒ—ãƒª     â”‚                          â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ + Prisma Client         â”‚                          â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚                                          â”‚â”‚ â”‚
â”‚  â”‚  â”‚                  â–¼                                          â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    RDS PostgreSQL Multi-AZ    â”‚                         â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   AWS Batch     â”‚ â† ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†              â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚ â”‚
â”‚  â”‚  â”‚   NAT    â”‚ â† ECS/Batch ã‹ã‚‰å¤–éƒ¨ API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç”¨            â”‚ â”‚
â”‚  â”‚  â”‚ Gateway  â”‚                                                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    S3    â”‚ â”‚Secrets Manager â”‚ â”‚CloudWatch â”‚ â”‚ ACM è¨¼æ˜æ›¸  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸»è¦ãªæ§‹æˆè¦ç´ 

| é …ç›® | æ§‹æˆ | èª¬æ˜ |
|------|------|------|
| ALB ã‚¿ã‚¤ãƒ— | **Internet-facing** | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ |
| ALB é…ç½® | **Public Subnet** | ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ |
| ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | **WAF ãƒ—ãƒ­ã‚­ã‚·IPåˆ¶é™ + SG** | ãƒ—ãƒ­ã‚­ã‚·IPã®ã¿è¨±å¯ |
| ã‚¢ã‚¯ã‚»ã‚¹çµŒè·¯ | **ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±** | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ |
| SSL è¨¼æ˜æ›¸ | **ACM ãƒ‘ãƒ–ãƒªãƒƒã‚¯è¨¼æ˜æ›¸** | Let's Encrypt äº’æ› |
| WAF | **å¿…é ˆ** | ãƒ—ãƒ­ã‚­ã‚·IPåˆ¶é™ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€è„…å¨æ¤œå‡º |
| NAT Gateway | **å¿…é ˆ** | å¤–éƒ¨ API ã‚¢ã‚¯ã‚»ã‚¹ç”¨ |

---

## 3. VPC ã®ä½œæˆ

### 3.1 AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ä½œæˆæ‰‹é †

1. **AWS ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«** ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã‚µãƒ¼ãƒ“ã‚¹æ¤œç´¢ã§ **VPC** ã‚’æ¤œç´¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ **VPC** â†’ **VPCã‚’ä½œæˆ** ã‚’ã‚¯ãƒªãƒƒã‚¯

### 3.2 VPC è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| ä½œæˆã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ | VPC ãªã© |
| åå‰ã‚¿ã‚°ã®è‡ªå‹•ç”Ÿæˆ | `testcasedb` |
| IPv4 CIDR ãƒ–ãƒ­ãƒƒã‚¯ | `10.0.0.0/16` |
| IPv6 CIDR ãƒ–ãƒ­ãƒƒã‚¯ | ãªã— |
| ãƒ†ãƒŠãƒ³ã‚·ãƒ¼ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
| ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚¾ãƒ¼ãƒ³ (AZ) ã®æ•° | 2 |
| ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã®æ•° | 2 |
| ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®æ•° | 2 |
| NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ | 1 AZ å†… |
| VPC ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | S3 ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ |

### 3.3 ä½œæˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹

ä»¥ä¸‹ãŒè‡ªå‹•ã§ä½œæˆã•ã‚Œã¾ã™ï¼š

- VPC: `testcasedb-vpc`
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ:
  - `testcasedb-subnet-public1-ap-northeast-1a` (10.0.0.0/20)
  - `testcasedb-subnet-public2-ap-northeast-1c` (10.0.16.0/20)
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ:
  - `testcasedb-subnet-private1-ap-northeast-1a` (10.0.128.0/20)
  - `testcasedb-subnet-private2-ap-northeast-1c` (10.0.144.0/20)
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤: `testcasedb-igw`
- NAT ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤: `testcasedb-nat-public1-ap-northeast-1a`
- ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ç”¨ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç”¨

---

## 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ

### 4.1 ALB ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ—ãƒ­ã‚­ã‚·IP åˆ¶é™ä»˜ãï¼‰

1. **VPC** â†’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—** â†’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å | `testcasedb-alb-sg` |
| èª¬æ˜ | Security group for Internet-facing ALB with proxy IP restriction |
| VPC | `testcasedb-vpc` |

**ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ï¼ˆãƒ—ãƒ­ã‚­ã‚·IP åˆ¶é™ï¼‰:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|--------|--------|--------|------|
| HTTPS | 443 | 203.0.113.50/32 | å®¢å…ˆãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ï¼ˆå¿…é ˆï¼‰ |
| HTTPS | 443 | 203.0.113.100/32 | ç®¡ç†è€…ç”¨ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹IPï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

> **é‡è¦**: å®¢å…ˆã®ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼IPã®ã¿ã‚’è¨±å¯ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·IPãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã¯ã€å¿…ãšã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | é€ä¿¡å…ˆ | èª¬æ˜ |
|--------|--------|--------|------|
| ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ | ã™ã¹ã¦ | 0.0.0.0/0 | Allow all outbound |

### 4.2 ECS ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

| é …ç›® | å€¤ |
|------|-----|
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å | `testcasedb-ecs-sg` |
| èª¬æ˜ | Security group for ECS |
| VPC | `testcasedb-vpc` |

**ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|--------|--------|--------|------|
| ã‚«ã‚¹ã‚¿ãƒ  TCP | 3000 | testcasedb-alb-sg | Allow from ALB only |

**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | é€ä¿¡å…ˆ | èª¬æ˜ |
|--------|--------|--------|------|
| ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ | ã™ã¹ã¦ | 0.0.0.0/0 | Allow all outbound |

### 4.3 RDS ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

| é …ç›® | å€¤ |
|------|-----|
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å | `testcasedb-rds-sg` |
| èª¬æ˜ | Security group for RDS |
| VPC | `testcasedb-vpc` |

**ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|--------|--------|--------|------|
| PostgreSQL | 5432 | testcasedb-ecs-sg | Allow from ECS |
| PostgreSQL | 5432 | testcasedb-batch-sg | Allow from Batch |

**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | é€ä¿¡å…ˆ | èª¬æ˜ |
|--------|--------|--------|------|
| ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ | ã™ã¹ã¦ | 0.0.0.0/0 | Allow all outbound |

### 4.4 Batch ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

| é …ç›® | å€¤ |
|------|-----|
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å | `testcasedb-batch-sg` |
| èª¬æ˜ | Security group for AWS Batch |
| VPC | `testcasedb-vpc` |

**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«:**

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | é€ä¿¡å…ˆ | èª¬æ˜ |
|--------|--------|--------|------|
| ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ | ã™ã¹ã¦ | 0.0.0.0/0 | Allow all outbound |

### 4.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚¢ã‚¯ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼                            â”‚
â”‚                                                             â”‚
â”‚   å®¢å…ˆãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ (203.0.113.50)                        â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”‚ HTTPS:443                                          â”‚
â”‚       â–¼                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ WAF                                                    â”‚
â”‚   â”‚ ãƒ»ãƒ—ãƒ­ã‚­ã‚·IPãƒã‚§ãƒƒã‚¯ (203.0.113.50/32)                 â”‚
â”‚   â”‚ ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™                                           â”‚
â”‚   â”‚ ãƒ»è„…å¨æ¤œå‡º                                             â”‚
â”‚   â”‚ ãƒ»ãã‚Œä»¥å¤–ã¯æ‹’å¦                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚              â–¼                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ALB (testcasedb-alb-sg)                                â”‚
â”‚   â”‚ ãƒ»203.0.113.50/32 è¨±å¯ï¼ˆãƒ—ãƒ­ã‚­ã‚·IPï¼‰                    â”‚
â”‚   â”‚ ãƒ»ãã‚Œä»¥å¤–ã¯æ‹’å¦                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚              â”‚ TCP:3000 (ALB-SGã‹ã‚‰ã®ã¿)                    â”‚
â”‚              â–¼                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ECS (testcasedb-ecs-sg)                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚              â”‚ TCP:5432 (ECS-SGã‹ã‚‰ã®ã¿)                    â”‚
â”‚              â–¼                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ RDS (testcasedb-rds-sg)                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. RDS PostgreSQL ã®ä½œæˆ

### 5.1 ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ

1. **RDS** â†’ **ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—** â†’ **DB ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| åå‰ | `testcasedb-db-subnet-group` |
| èª¬æ˜ | Subnet group for testcasedb |
| VPC | `testcasedb-vpc` |
| ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚¾ãƒ¼ãƒ³ | ap-northeast-1a, ap-northeast-1c |
| ã‚µãƒ–ãƒãƒƒãƒˆ | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ2ã¤ã‚’é¸æŠ |

### 5.2 RDS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ

1. **RDS** â†’ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** â†’ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ**

#### åŸºæœ¬è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| ã‚¨ãƒ³ã‚¸ãƒ³ã‚¿ã‚¤ãƒ— | PostgreSQL |
| ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | PostgreSQL 15.x (æœ€æ–°ã®å®‰å®šç‰ˆ) |
| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | æœ¬ç•ªç¨¼åƒç”¨ |
| å¯ç”¨æ€§ã¨è€ä¹…æ€§ | ãƒãƒ«ãƒAZ DB ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ |

#### è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| DB ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è­˜åˆ¥å­ | `testcasedb-postgres` |
| ãƒã‚¹ã‚¿ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å | `postgres` |
| èªè¨¼æƒ…å ±ã®ç®¡ç† | AWS Secrets Manager ã§ç®¡ç†ã™ã‚‹ |

#### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| DB ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ | db.t3.mediumï¼ˆæœ¬ç•ªã§ã¯ db.r6g.large ä»¥ä¸Šæ¨å¥¨ï¼‰ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ— | gp3 |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‰²ã‚Šå½“ã¦ | 100 GiB |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | æœ‰åŠ¹ï¼ˆæœ€å¤§ 500 GiBï¼‰ |

#### æ¥ç¶š

| é …ç›® | å€¤ |
|------|-----|
| VPC | `testcasedb-vpc` |
| DB ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— | `testcasedb-db-subnet-group` |
| ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ | **ãªã—ï¼ˆé‡è¦ï¼‰** |
| VPC ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— | `testcasedb-rds-sg` |
| ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚¾ãƒ¼ãƒ³ | æŒ‡å®šãªã— |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆ | 5432 |

#### è¿½åŠ è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å | `testcase_db` |
| è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | æœ‰åŠ¹ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“ | 7 æ—¥ï¼ˆæœ¬ç•ªã§ã¯ 14-35 æ—¥æ¨å¥¨ï¼‰ |
| æš—å·åŒ– | **æœ‰åŠ¹ï¼ˆå¿…é ˆï¼‰** |
| å‰Šé™¤ä¿è­· | **æœ‰åŠ¹ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯å¿…é ˆï¼‰** |

---

## 6. S3 ãƒã‚±ãƒƒãƒˆã®ä½œæˆ

### 6.1 ãƒ¡ã‚¤ãƒ³ãƒã‚±ãƒƒãƒˆã®ä½œæˆ

1. **S3** â†’ **ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ãƒã‚±ãƒƒãƒˆå | `testcasedb-files-{ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID}` |
| AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | ap-northeast-1 |
| ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ‰€æœ‰è€… | ACL ç„¡åŠ¹ |
| ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ | **ã™ã¹ã¦ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå¿…é ˆï¼‰** |
| ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° | æœ‰åŠ¹ |
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æš—å·åŒ– | SSE-S3 ã¾ãŸã¯ SSE-KMS |

### 6.2 ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã®ä½œæˆ

```
testcasedb-files-{ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID}/
â”œâ”€â”€ control-specs/        # åˆ¶å¾¡ä»•æ§˜æ›¸
â”œâ”€â”€ dataflows/            # ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ evidences/            # ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹
â”œâ”€â”€ imports/              # ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ capl-files/           # CAPLãƒ•ã‚¡ã‚¤ãƒ«
```

### 6.3 VPC ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆæ¨å¥¨ï¼‰

S3 ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«ç•™ã‚ã‚‹ãŸã‚ã€VPC ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

1. **VPC** â†’ **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** â†’ **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| åå‰ | `testcasedb-s3-endpoint` |
| ã‚µãƒ¼ãƒ“ã‚¹ã‚«ãƒ†ã‚´ãƒª | AWS ã‚µãƒ¼ãƒ“ã‚¹ |
| ã‚µãƒ¼ãƒ“ã‚¹ | com.amazonaws.ap-northeast-1.s3 (Gateway) |
| VPC | testcasedb-vpc |
| ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« |

---

## 7. Secrets Manager ã®è¨­å®š

### 7.1 JWT ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä½œæˆ

1. **Secrets Manager** â†’ **æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä¿å­˜ã™ã‚‹**

| é …ç›® | å€¤ |
|------|-----|
| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã‚¿ã‚¤ãƒ— | ãã®ä»–ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã‚¿ã‚¤ãƒ— |
| ã‚­ãƒ¼/å€¤ãƒšã‚¢ | |
| - `JWT_SECRET` | ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãª64æ–‡å­—ä»¥ä¸Šã®æ–‡å­—åˆ—ï¼‰ |
| - `NEXTAUTH_SECRET` | ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãª64æ–‡å­—ä»¥ä¸Šã®æ–‡å­—åˆ—ï¼‰ |
| æš—å·åŒ–ã‚­ãƒ¼ | aws/secretsmanager |

| é …ç›® | å€¤ |
|------|-----|
| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå | `testcasedb/jwt-secrets` |
| èª¬æ˜ | JWT and NextAuth secrets for testcasedb |

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå€¤ã®ç”Ÿæˆ:**

```bash
# ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
openssl rand -base64 64
```

---

## 8. IAM ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ

### 8.1 ECS ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«

1. **IAM** â†’ **ãƒ­ãƒ¼ãƒ«** â†’ **ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ— | AWS ã‚µãƒ¼ãƒ“ã‚¹ |
| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | Elastic Container Service â†’ Elastic Container Service Task |
| ãƒ­ãƒ¼ãƒ«å | `testcasedb-ecs-task-execution-role` |

**ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ãƒãƒªã‚·ãƒ¼:**

- `AmazonECSTaskExecutionRolePolicy`ï¼ˆAWS ç®¡ç†ï¼‰

**è¿½åŠ ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼** (SecretsManagerAccess):

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "secretsmanager:GetSecretValue"
            ],
            "Resource": [
                "arn:aws:secretsmanager:ap-northeast-1:*:secret:testcasedb/*",
                "arn:aws:secretsmanager:ap-northeast-1:*:secret:rds!*"
            ]
        }
    ]
}
```

### 8.2 ECS ã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

| é …ç›® | å€¤ |
|------|-----|
| ãƒ­ãƒ¼ãƒ«å | `testcasedb-ecs-task-role` |

**è¿½åŠ ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼:**

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::testcasedb-files-*",
                "arn:aws:s3:::testcasedb-files-*/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "secretsmanager:GetSecretValue"
            ],
            "Resource": [
                "arn:aws:secretsmanager:ap-northeast-1:*:secret:testcasedb/*",
                "arn:aws:secretsmanager:ap-northeast-1:*:secret:rds!*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "batch:SubmitJob",
                "batch:DescribeJobs",
                "batch:ListJobs"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "arn:aws:logs:ap-northeast-1:*:log-group:/ecs/testcasedb:*"
        }
    ]
}
```

### 8.3 AWS Batch ç”¨ãƒ­ãƒ¼ãƒ«

Batchã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã¨ã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åŒæ§˜ã«ä½œæˆã—ã¦ãã ã•ã„ã€‚

---

## 9. ECR ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ

### 9.1 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒªãƒã‚¸ãƒˆãƒª

1. **ECR** â†’ **ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ãƒªãƒã‚¸ãƒˆãƒªã‚¿ã‚¤ãƒ— | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |
| ãƒªãƒã‚¸ãƒˆãƒªå | `testcasedb/app` |
| ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã®å¤‰æ›´å¯èƒ½æ€§ | Immutableï¼ˆæ¨å¥¨ï¼‰ |
| æš—å·åŒ–è¨­å®š | AES-256 |
| ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ | ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«ã‚¹ã‚­ãƒ£ãƒ³ |

### 9.2 Batch ç”¨ãƒªãƒã‚¸ãƒˆãƒª

| é …ç›® | å€¤ |
|------|-----|
| ãƒªãƒã‚¸ãƒˆãƒªå | `testcasedb/batch` |

---

## 10. ECS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ

### 10.1 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ

1. **ECS** â†’ **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼** â†’ **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å | `testcasedb-cluster` |
| ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ | AWS Fargate |
| Container Insights | ã‚ªãƒ³ |

### 10.2 ã‚¿ã‚¹ã‚¯å®šç¾©ã®ä½œæˆ

1. **ECS** â†’ **ã‚¿ã‚¹ã‚¯å®šç¾©** â†’ **æ–°ã—ã„ã‚¿ã‚¹ã‚¯å®šç¾©ã®ä½œæˆ**

#### åŸºæœ¬è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ãƒŸãƒªãƒ¼ | `testcasedb-app` |
| èµ·å‹•ã‚¿ã‚¤ãƒ— | AWS Fargate |
| OS/ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | Linux/X86_64 |
| ã‚¿ã‚¹ã‚¯ã‚µã‚¤ã‚º - CPU | 1 vCPU |
| ã‚¿ã‚¹ã‚¯ã‚µã‚¤ã‚º - ãƒ¡ãƒ¢ãƒª | 2 GB |
| ã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | `testcasedb-ecs-task-role` |
| ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ« | `testcasedb-ecs-task-execution-role` |

#### ç’°å¢ƒå¤‰æ•°

| åå‰ | å€¤ã®ã‚¿ã‚¤ãƒ— | å€¤ |
|------|-----------|-----|
| NODE_ENV | Value | production |
| NEXTAUTH_URL | Value | https://testcasedb.example.com |
| DATABASE_URL | ValueFrom | (Secrets Manager ARN) |
| JWT_SECRET | ValueFrom | (Secrets Manager ARN) |
| AWS_S3_BUCKET | Value | testcasedb-files-{ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID} |

---

## 11. ACM è¨¼æ˜æ›¸ã®å–å¾—

### 11.1 ãƒ‘ãƒ–ãƒªãƒƒã‚¯è¨¼æ˜æ›¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

1. **Certificate Manager** â†’ **è¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

| é …ç›® | å€¤ |
|------|-----|
| è¨¼æ˜æ›¸ã‚¿ã‚¤ãƒ— | ãƒ‘ãƒ–ãƒªãƒƒã‚¯è¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| ãƒ‰ãƒ¡ã‚¤ãƒ³å | testcasedb.example.com |
| ã‚µãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆ¥å | www.testcasedb.example.comï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| æ¤œè¨¼æ–¹æ³• | **DNS æ¤œè¨¼**ï¼ˆæ¨å¥¨ï¼‰ |

### 11.2 DNS æ¤œè¨¼ã®å®Ÿæ–½

1. ACM ãŒæä¾›ã™ã‚‹ CNAME ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ Route 53 ã¾ãŸã¯å¤–éƒ¨ DNS ã«ç™»éŒ²
2. æ¤œè¨¼ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿï¼ˆé€šå¸¸5ã€œ30åˆ†ï¼‰

**Route 53 ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ:**
- ACM ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ **Route 53 ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è‡ªå‹•ã§è¿½åŠ ã•ã‚Œã¾ã™

---

## 12. WAF ã®è¨­å®šï¼ˆå¿…é ˆï¼‰

### 12.1 IP ã‚»ãƒƒãƒˆã®ä½œæˆï¼ˆãƒ—ãƒ­ã‚­ã‚·IPï¼‰

1. **WAF & Shield** â†’ **IP sets** â†’ **Create IP set**

| é …ç›® | å€¤ |
|------|-----|
| IP set name | `testcasedb-proxy-ip` |
| Region | Asia Pacific (Tokyo) |
| IP version | IPv4 |
| IP addresses | |

```
203.0.113.50/32
```

> **é‡è¦**: å®¢å…ˆã®ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®å›ºå®šIPã®ã¿ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚IPãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã¯ã€å¿…ãšã“ã®IPã‚»ãƒƒãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

**ç®¡ç†è€…ç”¨ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹IPï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:**

ç®¡ç†è€…ãŒåˆ¥ã®IPã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€è¿½åŠ ã®IPã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```
203.0.113.100/32
```

### 12.2 Web ACL ã®ä½œæˆ

1. **WAF & Shield** â†’ **Web ACLs** â†’ **Create web ACL**

| é …ç›® | å€¤ |
|------|-----|
| Name | `testcasedb-waf` |
| Resource type | Regional resources |
| Region | Asia Pacific (Tokyo) |
| Associated resources | ï¼ˆå¾Œã§ ALB ã‚’é–¢é€£ä»˜ã‘ï¼‰ |

### 12.3 ãƒ«ãƒ¼ãƒ«ã®è¨­å®š

**ãƒ«ãƒ¼ãƒ« 1: ãƒ—ãƒ­ã‚­ã‚·IP è¨±å¯ãƒ«ãƒ¼ãƒ«**

| é …ç›® | å€¤ |
|------|-----|
| Rule type | IP set |
| Name | `allow-proxy-ip` |
| IP set | testcasedb-proxy-ip |
| IP address to use | Source IP address |
| Action | Allow |
| Priority | 0 |

**ãƒ«ãƒ¼ãƒ« 2: ãƒ¬ãƒ¼ãƒˆåˆ¶é™**

| é …ç›® | å€¤ |
|------|-----|
| Rule type | Rate-based rule |
| Name | `rate-limit` |
| Rate limit | 2000ï¼ˆ5åˆ†é–“ã§2000ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ |
| IP address to use | Source IP address |
| Action | Block |
| Priority | 1 |

**ãƒ«ãƒ¼ãƒ« 3: AWS ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ« - ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ**

| é …ç›® | å€¤ |
|------|-----|
| Rule type | AWS managed rule groups |
| Name | AWSManagedRulesCommonRuleSet |
| Action | Block |
| Priority | 2 |

**ãƒ«ãƒ¼ãƒ« 4: AWS ãƒãƒãƒ¼ã‚¸ãƒ‰ ãƒ«ãƒ¼ãƒ« - æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹å…¥åŠ›**

| é …ç›® | å€¤ |
|------|-----|
| Name | AWSManagedRulesKnownBadInputsRuleSet |
| Action | Block |
| Priority | 3 |

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**

| é …ç›® | å€¤ |
|------|-----|
| Default action | **Block** |

> **é‡è¦**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ Block ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€è¨±å¯ãƒªã‚¹ãƒˆä»¥å¤–ã® IP ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã¹ã¦ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚

### 12.4 CloudWatch ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

WAF ã®ãƒ­ã‚°ã‚’ CloudWatch ã«é€ä¿¡ã—ã¾ã™:

1. Web ACL ã‚’é¸æŠ
2. **Logging and metrics** ã‚¿ãƒ–
3. **Enable logging**
4. ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—: `aws-waf-logs-testcasedb`

---

## 13. Application Load Balancer ã®ä½œæˆ

### 13.1 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ

1. **EC2** â†’ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—** â†’ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¿ã‚¤ãƒ— | IP ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—å | `testcasedb-tg` |
| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | HTTP |
| ãƒãƒ¼ãƒˆ | 3000 |
| VPC | testcasedb-vpc |

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¹ | `/api/health` |
| æ­£å¸¸ã®ã—ãã„å€¤ | 2 |
| éæ­£å¸¸ã®ã—ãã„å€¤ | 3 |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 5 ç§’ |
| é–“éš” | 30 ç§’ |

### 13.2 Application Load Balancer ã®ä½œæˆ

1. **EC2** â†’ **ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼** â†’ **ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ä½œæˆ** â†’ **Application Load Balancer**

| é …ç›® | å€¤ |
|------|-----|
| ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼å | `testcasedb-alb` |
| ã‚¹ã‚­ãƒ¼ãƒ  | **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‘ã‘ï¼ˆInternet-facingï¼‰** |
| IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¿ã‚¤ãƒ— | IPv4 |

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒƒãƒ”ãƒ³ã‚°

| é …ç›® | å€¤ |
|------|-----|
| VPC | testcasedb-vpc |
| ãƒãƒƒãƒ”ãƒ³ã‚° | **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ**ï¼ˆ2ã¤é¸æŠï¼‰ |

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

| é …ç›® | å€¤ |
|------|-----|
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— | testcasedb-alb-sg |

#### ãƒªã‚¹ãƒŠãƒ¼ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**HTTP ãƒªã‚¹ãƒŠãƒ¼ (80):**

| é …ç›® | å€¤ |
|------|-----|
| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | HTTP |
| ãƒãƒ¼ãƒˆ | 80 |
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | HTTPS ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒãƒ¼ãƒˆ443ï¼‰ |

**HTTPS ãƒªã‚¹ãƒŠãƒ¼ (443):**

| é …ç›® | å€¤ |
|------|-----|
| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | HTTPS |
| ãƒãƒ¼ãƒˆ | 443 |
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | è»¢é€å…ˆ â†’ testcasedb-tg |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ | ELBSecurityPolicy-TLS13-1-2-2021-06 |
| SSL/TLS è¨¼æ˜æ›¸ | ACM ã§å–å¾—ã—ãŸè¨¼æ˜æ›¸ã‚’é¸æŠ |

### 13.3 WAF ã‚’ ALB ã«é–¢é€£ä»˜ã‘

1. **WAF & Shield** â†’ **Web ACLs** â†’ `testcasedb-waf`
2. **Associated AWS resources** ã‚¿ãƒ–
3. **Add AWS resources**
4. `testcasedb-alb` ã‚’é¸æŠ

---

## 14. Route 53 DNS è¨­å®š

### 14.1 ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã®ç¢ºèª

æ—¢å­˜ã®ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ï¼ˆexample.comï¼‰ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

### 14.2 A ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆ

1. **Route 53** â†’ **ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³** â†’ `example.com`
2. **ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ**

| é …ç›® | å€¤ |
|------|-----|
| ãƒ¬ã‚³ãƒ¼ãƒ‰å | testcasedb |
| ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | A - IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | ã¯ã„ |
| ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆ | Application Load Balancer |
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | Asia Pacific (Tokyo) |
| ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ | testcasedb-alb |

---

## 15. AWS Batch ã®è¨­å®š

### 15.1 ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆç’°å¢ƒã®ä½œæˆ

```bash
aws batch create-compute-environment \
  --compute-environment-name testcasedb-compute-env \
  --type MANAGED \
  --state ENABLED \
  --compute-resources '{
    "type": "FARGATE",
    "maxvCpus": 4,
    "subnets": ["subnet-xxxxx", "subnet-yyyyy"],
    "securityGroupIds": ["sg-xxxxx"]
  }' \
  --region ap-northeast-1
```

### 15.2 ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼ã®ä½œæˆ

```bash
aws batch create-job-queue \
  --job-queue-name testcasedb-job-queue \
  --state ENABLED \
  --priority 1 \
  --compute-environment-order '[
    {
      "order": 1,
      "computeEnvironment": "testcasedb-compute-env"
    }
  ]' \
  --region ap-northeast-1
```

### 15.3 ã‚¸ãƒ§ãƒ–å®šç¾©ã®ä½œæˆ

```json
{
  "jobDefinitionName": "testcasedb-import-job",
  "type": "container",
  "platformCapabilities": ["FARGATE"],
  "containerProperties": {
    "image": "123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/testcasedb/batch:latest",
    "jobRoleArn": "arn:aws:iam::123456789012:role/testcasedb-batch-task-role",
    "executionRoleArn": "arn:aws:iam::123456789012:role/testcasedb-batch-execution-role",
    "resourceRequirements": [
      {
        "type": "VCPU",
        "value": "0.25"
      },
      {
        "type": "MEMORY",
        "value": "512"
      }
    ],
    "environment": [
      {
        "name": "AWS_REGION",
        "value": "ap-northeast-1"
      },
      {
        "name": "NODE_ENV",
        "value": "production"
      }
    ],
    "secrets": [
      {
        "name": "DATABASE_URL",
        "valueFrom": "arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:testcasedb/database-url"
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/aws/batch/testcasedb",
        "awslogs-region": "ap-northeast-1",
        "awslogs-stream-prefix": "import"
      }
    },
    "fargatePlatformConfiguration": {
      "platformVersion": "LATEST"
    }
  }
}
```

---

## 16. CloudWatch ã®è¨­å®š

### 16.1 ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ

| ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—å | ä¿æŒæœŸé–“ | æš—å·åŒ– |
|---------------|---------|--------|
| /ecs/testcasedb | 90 æ—¥ | æœ‰åŠ¹ï¼ˆæ¨å¥¨ï¼‰ |
| /aws/batch/testcasedb | 90 æ—¥ | æœ‰åŠ¹ |
| aws-waf-logs-testcasedb | 90 æ—¥ | æœ‰åŠ¹ |

### 16.2 é‡è¦ãªã‚¢ãƒ©ãƒ¼ãƒ 

| ã‚¢ãƒ©ãƒ¼ãƒ  | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ã—ãã„å€¤ | é€šçŸ¥å…ˆ |
|---------|-----------|---------|--------|
| ECS CPU é«˜è² è· | CPUUtilization | > 80% | SNS |
| RDS CPU é«˜è² è· | CPUUtilization | > 80% | SNS |
| RDS æ¥ç¶šæ•°ä¸Šé™ | DatabaseConnections | > 80% of max | SNS |
| ALB 5xx ã‚¨ãƒ©ãƒ¼ | HTTPCode_ELB_5XX_Count | > 10/5min | SNS |
| WAF ãƒ–ãƒ­ãƒƒã‚¯æ€¥å¢— | BlockedRequests | > 100/5min | SNS |

---

## 17. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 17.1 Dockerfile

```dockerfile
# ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸
FROM node:20-alpine AS builder

WORKDIR /app

COPY package*.json ./
COPY prisma ./prisma/

RUN npm ci

COPY . .

RUN npx prisma generate
RUN npm run build

# å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¸
FROM node:20-alpine AS runner

WORKDIR /app

ENV NODE_ENV production

COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/node_modules/.prisma ./node_modules/.prisma

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

### 17.2 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

`app/api/health/route.ts`:

```typescript
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({ status: 'healthy' }, { status: 200 });
}
```

### 17.3 ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/bin/bash
set -e

AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
AWS_REGION="ap-northeast-1"
ECR_REPO="${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/testcasedb/app"
IMAGE_TAG=$(git rev-parse --short HEAD)

echo "Building Docker image..."
docker build -t testcasedb/app:${IMAGE_TAG} .

echo "Logging in to ECR..."
aws ecr get-login-password --region ${AWS_REGION} | \
  docker login --username AWS --password-stdin ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com

echo "Pushing image..."
docker tag testcasedb/app:${IMAGE_TAG} ${ECR_REPO}:${IMAGE_TAG}
docker push ${ECR_REPO}:${IMAGE_TAG}
docker tag testcasedb/app:${IMAGE_TAG} ${ECR_REPO}:latest
docker push ${ECR_REPO}:latest

echo "Updating ECS service..."
aws ecs update-service \
  --cluster testcasedb-cluster \
  --service testcasedb-service \
  --force-new-deployment \
  --region ${AWS_REGION}

echo "Deployment completed!"
```

### 17.4 é–‹ç™ºç’°å¢ƒã§ã®S3ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ

æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã€é–‹ç™ºå…ƒã‹ã‚‰S3ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

#### 17.4.1 é–‹ç™ºå…ƒIPã®è¿½åŠ 

**1. é–‹ç™ºå…ƒã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚’ç¢ºèª:**

```bash
# ç¾åœ¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚’ç¢ºèª
curl ifconfig.me
# ã¾ãŸã¯
curl https://checkip.amazonaws.com

# ä¾‹: 198.51.100.50
```

**2. WAF IPã‚»ãƒƒãƒˆã«é–‹ç™ºå…ƒIPã‚’è¿½åŠ :**

1. **WAF & Shield** â†’ **IP sets** â†’ `testcasedb-proxy-ip`
2. **Edit** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ :

```
203.0.113.50/32   # å®¢å…ˆãƒ—ãƒ­ã‚­ã‚·ï¼ˆæ—¢å­˜ï¼‰
198.51.100.50/32  # é–‹ç™ºå…ƒIPï¼ˆè¿½åŠ ï¼‰â† ã‚ãªãŸã®IPã«ç½®ãæ›ãˆ
```

**3. ALB ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«é–‹ç™ºå…ƒIPã‚’è¿½åŠ :**

1. **EC2** â†’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—** â†’ `testcasedb-alb-sg`
2. **ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«** â†’ **ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’ç·¨é›†**
3. **ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ **:

| ã‚¿ã‚¤ãƒ— | ãƒãƒ¼ãƒˆ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|--------|--------|--------|------|
| HTTPS | 443 | 198.51.100.50/32 | é–‹ç™ºå…ƒãƒ†ã‚¹ãƒˆç”¨ |

#### 17.4.2 S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆã¨ãƒ†ã‚¹ãƒˆ

**1. S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ:**

```bash
# AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’ç¢ºèª
AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)

# S3ãƒã‚±ãƒƒãƒˆä½œæˆ
aws s3 mb s3://testcasedb-files-${AWS_ACCOUNT_ID} --region ap-northeast-1

# ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–
aws s3api put-bucket-versioning \
  --bucket testcasedb-files-${AWS_ACCOUNT_ID} \
  --versioning-configuration Status=Enabled

# ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¿…é ˆï¼‰
aws s3api put-public-access-block \
  --bucket testcasedb-files-${AWS_ACCOUNT_ID} \
  --public-access-block-configuration \
    "BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"

# æš—å·åŒ–ã‚’æœ‰åŠ¹åŒ–
aws s3api put-bucket-encryption \
  --bucket testcasedb-files-${AWS_ACCOUNT_ID} \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      }
    }]
  }'
```

**2. ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã‚’ä½œæˆ:**

```bash
BUCKET_NAME="testcasedb-files-${AWS_ACCOUNT_ID}"

# å„ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ
aws s3api put-object --bucket ${BUCKET_NAME} --key control-specs/
aws s3api put-object --bucket ${BUCKET_NAME} --key dataflows/
aws s3api put-object --bucket ${BUCKET_NAME} --key evidences/
aws s3api put-object --bucket ${BUCKET_NAME} --key imports/
aws s3api put-object --bucket ${BUCKET_NAME} --key capl-files/

# ç¢ºèª
aws s3 ls s3://${BUCKET_NAME}/
```

**3. AWS CLIã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ:**

```bash
# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
echo "Test file content" > test.txt
aws s3 cp test.txt s3://${BUCKET_NAME}/test/test.txt

# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
aws s3 cp s3://${BUCKET_NAME}/test/test.txt downloaded.txt

# ç¢ºèª
cat downloaded.txt

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
rm test.txt downloaded.txt
```

#### 17.4.3 ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ

**1. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:**

`.env.local` ã‚’ä½œæˆ:

```bash
# AWSè¨­å®š
AWS_REGION=ap-northeast-1
AWS_S3_BUCKET=testcasedb-files-123456789012  # â† ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã«ç½®ãæ›ãˆ
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE       # â† IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
DATABASE_URL=postgresql://user:password@localhost:5432/testcase_db

# NextAuth
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-here
```

**2. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…:**

`app/api/upload/route.ts`:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';
import { requireAuth } from '@/app/lib/auth';

const s3Client = new S3Client({
  region: process.env.AWS_REGION || 'ap-northeast-1',
});

export async function POST(req: NextRequest) {
  try {
    const user = await requireAuth(req);
    const formData = await req.formData();
    const file = formData.get('file') as File;
    const fileType = formData.get('fileType') as string;
    const testGroupId = formData.get('testGroupId') as string;
    const tid = formData.get('tid') as string;

    if (!file || !fileType || !testGroupId || !tid) {
      return NextResponse.json(
        { success: false, error: 'Missing required fields' },
        { status: 400 }
      );
    }

    const arrayBuffer = await file.arrayBuffer();
    const buffer = Buffer.from(arrayBuffer);

    const timestamp = Date.now();
    const sanitizedFileName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
    const s3Key = `${fileType}/${testGroupId}/${tid}/${timestamp}_${sanitizedFileName}`;

    const command = new PutObjectCommand({
      Bucket: process.env.AWS_S3_BUCKET!,
      Key: s3Key,
      Body: buffer,
      ContentType: file.type,
      Metadata: {
        'uploaded-by': user.email,
        'original-filename': file.name,
      },
    });

    await s3Client.send(command);

    return NextResponse.json({
      success: true,
      data: {
        key: s3Key,
        fileName: file.name,
        fileSize: file.size,
      },
    });
  } catch (error) {
    console.error('Upload failed:', error);
    return NextResponse.json(
      { success: false, error: 'Upload failed' },
      { status: 500 }
    );
  }
}
```

`app/api/download/route.ts`:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { S3Client, GetObjectCommand } from '@aws-sdk/client-s3';
import { getSignedUrl } from '@aws-sdk/s3-request-presigner';
import { requireAuth } from '@/app/lib/auth';

const s3Client = new S3Client({
  region: process.env.AWS_REGION || 'ap-northeast-1',
});

export async function GET(req: NextRequest) {
  try {
    await requireAuth(req);

    const { searchParams } = new URL(req.url);
    const s3Key = searchParams.get('key');

    if (!s3Key) {
      return NextResponse.json(
        { success: false, error: 'Missing key parameter' },
        { status: 400 }
      );
    }

    const command = new GetObjectCommand({
      Bucket: process.env.AWS_S3_BUCKET!,
      Key: s3Key,
    });

    const signedUrl = await getSignedUrl(s3Client, command, {
      expiresIn: 900, // 15åˆ†
    });

    return NextResponse.json({
      success: true,
      data: {
        url: signedUrl,
        expiresIn: 900,
      },
    });
  } catch (error) {
    console.error('Download URL generation failed:', error);
    return NextResponse.json(
      { success: false, error: 'Failed to generate download URL' },
      { status: 500 }
    );
  }
}
```

**3. S3ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**

`scripts/test-s3.ts`:

```typescript
import { S3Client, PutObjectCommand, GetObjectCommand } from '@aws-sdk/client-s3';

const s3Client = new S3Client({
  region: process.env.AWS_REGION || 'ap-northeast-1'
});

async function testS3() {
  const bucketName = process.env.AWS_S3_BUCKET!;
  const testKey = 'test/test-file.txt';
  const testContent = 'Hello from S3 test!';

  try {
    console.log('ğŸ§ª Testing S3 upload...');
    await s3Client.send(new PutObjectCommand({
      Bucket: bucketName,
      Key: testKey,
      Body: testContent,
      ContentType: 'text/plain',
    }));
    console.log('âœ… Upload successful!');

    console.log('ğŸ§ª Testing S3 download...');
    const response = await s3Client.send(new GetObjectCommand({
      Bucket: bucketName,
      Key: testKey,
    }));
    const data = await response.Body?.transformToString();
    console.log('âœ… Download successful!');
    console.log('ğŸ“„ Content:', data);

  } catch (error) {
    console.error('âŒ S3 test failed:', error);
    process.exit(1);
  }
}

testS3();
```

å®Ÿè¡Œ:

```bash
npx tsx scripts/test-s3.ts
```

**4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§å‹•ä½œç¢ºèª:**

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹
# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç·¨é›†ç”»é¢ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

#### 17.4.4 å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| é …ç›® | ç¢ºèª |
|------|------|
| â˜ é–‹ç™ºå…ƒIPã‚’WAF IPã‚»ãƒƒãƒˆã«è¿½åŠ ã—ãŸ | |
| â˜ é–‹ç™ºå…ƒIPã‚’ALB SGã«è¿½åŠ ã—ãŸ | |
| â˜ S3ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ | |
| â˜ S3ãƒã‚±ãƒƒãƒˆã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ | |
| â˜ S3ãƒã‚±ãƒƒãƒˆã®æš—å·åŒ–ãŒæœ‰åŠ¹ | |
| â˜ AWS CLIã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒæˆåŠŸã™ã‚‹ | |
| â˜ ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰S3ã‚¢ã‚¯ã‚»ã‚¹ãŒæˆåŠŸã™ã‚‹ | |
| â˜ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµŒç”±ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒæˆåŠŸã™ã‚‹ | |
| â˜ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµŒç”±ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒæˆåŠŸã™ã‚‹ | |
| â˜ CloudWatch Logsã§ãƒ­ã‚°ãŒç¢ºèªã§ãã‚‹ | |

#### 17.4.5 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ã‚¨ãƒ©ãƒ¼: Access Denied (S3)**

```bash
# IAMãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ç¢ºèª
aws iam get-user-policy --user-name your-user --policy-name S3Access

# S3ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèª
aws s3api get-bucket-policy --bucket testcasedb-files-${AWS_ACCOUNT_ID}
```

**ã‚¨ãƒ©ãƒ¼: Bucket does not exist**

```bash
# ãƒã‚±ãƒƒãƒˆã®å­˜åœ¨ç¢ºèª
aws s3 ls | grep testcasedb

# ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
aws s3api get-bucket-location --bucket testcasedb-files-${AWS_ACCOUNT_ID}
```

**ã‚¨ãƒ©ãƒ¼: 403 Forbidden (ALB/WAF)**

- WAF IPã‚»ãƒƒãƒˆã«é–‹ç™ºå…ƒIPãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ALB ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«é–‹ç™ºå…ƒIPãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ `/32` ã§çµ‚ã‚ã£ã¦ã„ã‚‹ã‹ç¢ºèª

**ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ:**

æœ¬ç•ªç’°å¢ƒã«ç§»è¡Œã™ã‚‹éš›ã¯ã€é–‹ç™ºç”¨IPã‚’å‰Šé™¤ã™ã‚‹ã‹ã€æœ¬ç•ªç”¨ã®ãƒ—ãƒ­ã‚­ã‚·IPã®ã¿ã‚’æ®‹ã™ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

---

## 18. å‹•ä½œç¢ºèª

### 18.1 DNS è§£æ±ºã®ç¢ºèª

```bash
# DNS ãŒæ­£ã—ãè§£æ±ºã•ã‚Œã‚‹ã‹ç¢ºèª
nslookup testcasedb.example.com

# æœŸå¾…çµæœ: ALB ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¿”ã•ã‚Œã‚‹
```

### 18.2 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª

```bash
# è¨±å¯ã•ã‚ŒãŸIPã‹ã‚‰
curl https://testcasedb.example.com/api/health
# æœŸå¾…çµæœ: {"status":"healthy"}

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# https://testcasedb.example.com
```

### 18.3 IP åˆ¶é™ç¢ºèª

```bash
# è¨±å¯ã•ã‚Œã¦ã„ãªã„ IP ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã‚‹
# â†’ 403 Forbidden ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
```

### 18.4 SSL è¨¼æ˜æ›¸ã®ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://testcasedb.example.com ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ä»¥ä¸‹ã‚’ç¢ºèª:
- éµã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- è¨¼æ˜æ›¸ãŒæœ‰åŠ¹
- è¨¼æ˜æ›¸ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒä¸€è‡´

---

## 19. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 19.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

| é …ç›® | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|------|---------|------|
| ALB | Internet-facing ã‚¿ã‚¤ãƒ—ã«ãªã£ã¦ã„ã‚‹ã‹ | â˜ |
| ALB | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| SG | ALB ã« IP åˆ¶é™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| SG | RDS ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| WAF | IP è¨±å¯ãƒ«ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| WAF | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |

### 19.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

| é …ç›® | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|------|---------|------|
| RDS | æš—å·åŒ–ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ | â˜ |
| RDS | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ | â˜ |
| S3 | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| S3 | æš—å·åŒ–ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ | â˜ |
| Secrets | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒ Secrets Manager ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |

### 19.3 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

| é …ç›® | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|------|---------|------|
| IP åˆ¶é™ | è¨±å¯ IP ãŒå¿…è¦æœ€å°é™ã‹ | â˜ |
| IAM | æœ€å°æ¨©é™ã®åŸå‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹ | â˜ |
| WAF | AWS ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ãŒæœ‰åŠ¹ã‹ | â˜ |
| è¨¼æ˜æ›¸ | ACM è¨¼æ˜æ›¸ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| HTTPS | HTTP ãŒ HTTPS ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã‹ | â˜ |

### 19.4 ç›£è¦–ãƒ»ãƒ­ã‚°

| é …ç›® | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|------|---------|------|
| CloudWatch | ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| CloudWatch | é‡è¦ãªã‚¢ãƒ©ãƒ¼ãƒ ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |
| WAF | ãƒ–ãƒ­ãƒƒã‚¯ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ | â˜ |

### 19.5 é‹ç”¨

| é …ç›® | ç¢ºèªå†…å®¹ | çŠ¶æ…‹ |
|------|---------|------|
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | RDS ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒæœ‰åŠ¹ã‹ | â˜ |
| å‰Šé™¤ä¿è­· | RDS ã®å‰Šé™¤ä¿è­·ãŒæœ‰åŠ¹ã‹ | â˜ |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° | S3 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ã‹ | â˜ |

---

## 20. æ³¨æ„äº‹é …ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 20.1 ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

#### ALB ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

| ç¢ºèªé …ç›® | å¯¾å‡¦æ³• |
|---------|--------|
| DNS | åå‰è§£æ±ºãŒã§ãã¦ã„ã‚‹ã‹ nslookup ã§ç¢ºèª |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— | æ¥ç¶šå…ƒ IP ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª |
| WAF | IP ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ã‹ CloudWatch ãƒ­ã‚°ã‚’ç¢ºèª |
| ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ | ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒé€šã£ã¦ã„ã‚‹ã‹ |

#### è¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

| ç¢ºèªé …ç›® | å¯¾å‡¦æ³• |
|---------|--------|
| DNS æ¤œè¨¼ | ACM è¨¼æ˜æ›¸ã®æ¤œè¨¼ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ |
| ãƒ‰ãƒ¡ã‚¤ãƒ³å | è¨¼æ˜æ›¸ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚¹å…ˆãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ |
| æœ‰åŠ¹æœŸé™ | è¨¼æ˜æ›¸ãŒæœŸé™åˆ‡ã‚Œã«ãªã£ã¦ã„ãªã„ã‹ï¼ˆACM ã¯è‡ªå‹•æ›´æ–°ï¼‰ |

#### WAF ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹

| ç¢ºèªé …ç›® | å¯¾å‡¦æ³• |
|---------|--------|
| IP ã‚»ãƒƒãƒˆ | æ¥ç¶šå…ƒ IP ãŒè¨±å¯ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | çŸ­æ™‚é–“ã«å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ã„ãªã„ã‹ |
| ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ« | æ­£å½“ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒèª¤æ¤œçŸ¥ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª |

### 20.2 é‹ç”¨ä¸Šã®é‡è¦ãªæ³¨æ„äº‹é …

> **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£:**

1. **IP ãƒ¬ãƒ³ã‚¸ã®å¤‰æ›´ã¯æ…é‡ã«**
   - æ–°è¦è¿½åŠ æ™‚ã¯äº‹å‰ãƒ†ã‚¹ãƒˆ
   - å‰Šé™¤æ™‚ã¯å½±éŸ¿ç¯„å›²ã‚’ç¢ºèª

2. **WAF ãƒ«ãƒ¼ãƒ«ã®å®šæœŸè¦‹ç›´ã—**
   - èª¤æ¤œçŸ¥ãŒãªã„ã‹æœˆæ¬¡ã§ç¢ºèª
   - è„…å¨ã®å‚¾å‘ã«å¿œã˜ã¦ãƒ«ãƒ¼ãƒ«ã‚’èª¿æ•´

3. **è¨¼æ˜æ›¸ã®è‡ªå‹•æ›´æ–°ç¢ºèª**
   - ACM ã¯è‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹ãŒã€DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹å®šæœŸç¢ºèª

> **é‹ç”¨é–¢é€£:**

4. **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ³¨æ„**
   - æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã¯æ¥­å‹™æ™‚é–“å¤–ã‚’æ¨å¥¨
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’äº‹å‰ã«æº–å‚™

5. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ç¢ºèª**
   - RDS ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ã®å¾©å…ƒãƒ†ã‚¹ãƒˆã‚’å®šæœŸå®Ÿæ–½
   - S3 ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‹ã‚‰ã®å¾©å…ƒæ‰‹é †ã‚’ç¢ºèª

6. **ã‚³ã‚¹ãƒˆç®¡ç†**
   - æœˆæ¬¡ã§ã‚³ã‚¹ãƒˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã¯å‰Šé™¤

### 20.3 éšœå®³æ™‚ã®é€£çµ¡å…ˆ

| éšœå®³ç¨®åˆ¥ | é€£çµ¡å…ˆ | å¯¾å¿œæ™‚é–“ |
|---------|--------|---------|
| AWS éšœå®³ | AWS ã‚µãƒãƒ¼ãƒˆ | 24/365 |
| ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³éšœå®³ | é–‹ç™ºãƒãƒ¼ãƒ  | å¹³æ—¥ 9:00-18:00 |
| DNS éšœå®³ | ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†è€… | å¹³æ—¥ 9:00-18:00 |

---

## ä»˜éŒ²

### A. ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆæœˆé¡æ¦‚ç®—ï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | æ§‹æˆ | æ¦‚ç®—æœˆé¡ (USD) |
|---------|------|---------------|
| ECS Fargate | 1 vCPU, 2GB Ã— 2 ã‚¿ã‚¹ã‚¯ | ~$60 |
| RDS PostgreSQL | db.t3.medium, Multi-AZ | ~$150 |
| Application ALB | 1 ALB | ~$25 |
| NAT Gateway | 1 NAT + ãƒ‡ãƒ¼ã‚¿è»¢é€ | ~$45 |
| S3 | 100GB | ~$5 |
| WAF | 1 Web ACL + ãƒ«ãƒ¼ãƒ« | ~$10 |
| CloudWatch | ãƒ­ã‚° + ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ~$10 |
| Route 53 | ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ + ã‚¯ã‚¨ãƒª | ~$1 |
| ACM | ãƒ‘ãƒ–ãƒªãƒƒã‚¯è¨¼æ˜æ›¸ | **ç„¡æ–™** |
| **åˆè¨ˆ** | | **~$306** |

### B. ãƒ—ãƒ­ã‚­ã‚·IPåˆ¶é™ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ—ãƒ­ã‚­ã‚·IPã®ç®¡ç†**
   - ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®å›ºå®šIPã®ã¿ã‚’ç™»éŒ²
   - IPå¤‰æ›´æ™‚ã®æ›´æ–°ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºç«‹ï¼ˆWAF IPã‚»ãƒƒãƒˆ + ALB SGï¼‰
   - å¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²

2. **ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã‚¢ã‚¯ã‚»ã‚¹ã®ç¢ºèª**
   - å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ­ã‚­ã‚·ã‚’çµŒç”±ã—ã¦ã„ã‚‹ã“ã¨ã‚’å®šæœŸçš„ã«ç¢ºèª
   - ãƒ—ãƒ­ã‚­ã‚·ãƒã‚¤ãƒ‘ã‚¹è¨­å®šãŒãªã„ã“ã¨ã‚’ç¢ºèª
   - ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯æ™‚ã‚‚VPNçµŒç”±ã§ãƒ—ãƒ­ã‚­ã‚·ã‚’é€šã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ç·Šæ€¥æ™‚ã®ã‚¢ã‚¯ã‚»ã‚¹**
   - ç®¡ç†è€…ç”¨ã®ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ IP ã‚’åˆ¥é€”ç¢ºä¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - ä¸€æ™‚çš„ãª IP è¿½åŠ æ‰‹é †ã‚’æ–‡æ›¸åŒ–
   - ãƒ—ãƒ­ã‚­ã‚·éšœå®³æ™‚ã®ä»£æ›¿ã‚¢ã‚¯ã‚»ã‚¹æ‰‹æ®µã‚’æ¤œè¨

4. **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**
   - WAFãƒ­ã‚°ã§ãƒ—ãƒ­ã‚­ã‚·IPä»¥å¤–ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã‚’ç›£è¦–
   - ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º
   - ãƒ—ãƒ­ã‚­ã‚·IPã‹ã‚‰ã®å¤§é‡ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç›£è¦–

### C. å‚è€ƒãƒªãƒ³ã‚¯

- [AWS WAF ã‚¬ã‚¤ãƒ‰](https://docs.aws.amazon.com/waf/)
- [ECS Fargate ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/)
- [ACM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](https://docs.aws.amazon.com/acm/)
- [ALB ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/)
